# 1. gitops



# 基础设施Infrastructure

## 需要准备的Infrastructure

基础设施是我们在实施IaC之前需要提前准备好的一些功能性组件，比如DNS，NTP，证书等。在公有云上，一部分的工作已经在我们配置镜像到实例的过程中就完成的，但是在私有云中我们就需要自己来提前准备。下面的表对我们需要用到的基础设施进行了统计。

| 基础设施   | 说明                                                         | 公有云                                                       | 私有云                                                       |
| ---------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| DNS        | 解析记录，特别是A记录，我们在标准化的过程中，为了让所有配置文件保持一致，都会使用域名，比如私有的nfs服务，如果我们使用nfs.example.com，我们就可以在所有的机器上使用这个域名，即使有迁移或者需要大规模改动的场景，我们只需要修改DNS记录。如果我们使用的是IP地址，那么我们至少需要去运行一个批量修改的命令对他们修改，如果架构更加复杂，我们就需要更多的操作。 | 公有云上是有dns服务的，即使我们并没有配置，那么他也会以VPC为单位，对VPC中的实例生效 | 私有云中我们可以使用AD或者Linux的bind服务来自己搭建DNS服务。当然，修改/etc/hosts文件的方式也可以，但是不太建议这么做，IaS中尽量要保持通用的东西的一致性 |
| NTP        | 时间服务在任何的计算设备上都是非常重要的服务，因此，我们需要提前准备好ntp服务器。 | 公有云上的ntp服务也是默认的，只需要使用镜像中默认提供的ntp服务就可以了 | 私有云中需要注意的是，默认情况下，并不是所有机器都可以连接外网，因此，我们需要准备一台可以连接外网的服务器来做ntp服务器，其他的服务器只需要向这台服务器进行时间同步就好了 |
| 上网代理   | 有些环境下，服务器是不可以和外网进行通讯的，但是为了方便配置，我们就需要连接外网，这个时候就需要使用一台服务器能够连接外网，而其他服务器通过代理的方式，从这台服务器来转发流量，从而达到访问控制的目的 | 大部分公有云是没有这种服务器的，因为在公有云上，安全组和ACL就完全能控制到我们的访问了，没必要通过代理服务器来控制 | 私有云上，我们可以使用squid服务来实现，当然，很多上网行为管理的软件和硬件同样可以，这些软硬件的功能和性能都比单纯的squid要强大，但是价格也非常昂贵 |
| 认证和授权 | 一般来说Windows机器是一定要加到ad域的，但是Linux可以选择加到AD域，或者加到其他LDAP协议的控制器上来实现统一的认证，管理和审计 | 公有云上有成型的产品，比如AAD，或者SSO之类的服务             | 私有云上我们可以把Linux加到AD中，或者使用ldap类的服务，比如红帽的pam。也可以使用类似堡垒机，比如JumpServer |

